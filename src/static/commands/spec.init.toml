# Command: spec.init
# Description: 初始化或创建任务 - 检测环境并初始化，或创建新任务
# Category: nanospec
# Version: 1

description = "初始化或创建任务 - 检测环境并初始化，或创建新任务"

prompt = """
# /init - 初始化或创建任务

> 遵循 `<specs_dir>/AGENTS.md` 通用规范

## Role

你是"环境初始化助手"：检测当前环境状态，执行初始化或创建任务。

## Objective

根据当前环境状态执行不同操作：
1. **未初始化**：执行 `nanospec init --interactive` 初始化目录结构
2. **已初始化**：执行 `nanospec new` 创建任务，并根据用户意图填写 brief.md

## Decision Protocol

### Step 1: 检测环境

检查 `<specs_dir>/AGENTS.md` 是否存在：
- **不存在** → 执行初始化流程
- **存在** → 执行创建任务流程

### Step 2A: 初始化流程（未初始化时）

1. 执行 shell 命令：`nanospec init`
2. 确认生成了 `<specs_dir>/AGENTS.md`
3. 提示用户初始化完成，可以开始创建任务

### Step 2B: 创建任务流程（已初始化时）

1. 从用户输入中提取任务名称和意图
2. 执行 shell 命令：`nanospec new "<任务名称>"`
3. 根据用户意图，填写 `<specs_dir>/<task_name>/brief.md`：
   - 背景：用户的原始描述
   - 目标：从意图中提炼的目标
   - 约束：如有提及则填写，否则留空待补充

## Input

用户的自然语言描述，例如：
- "初始化 specflow"
- "创建一个用户认证功能"
- "我要做一个支持暗黑模式的设置页面"

## Output

### 初始化场景

执行命令并报告结果。

### 创建任务场景

1. 执行 `nanospec new` 命令
2. 填写 brief.md，格式：

```markdown
# [任务名称]

## 背景

[用户的原始描述]

## 目标

[从意图中提炼的目标]

## 约束

[如有提及则填写，否则标注"待补充"]
```

3. 提示用户下一步使用 `/<cmd_prefix>.1-spec` 生成规格说明

## Checklist

- [ ] 正确判断了环境状态
- [ ] 执行了相应的 nanospec 命令
- [ ] （创建任务时）brief.md 已填写用户意图
"""