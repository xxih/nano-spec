---
# 规格驱动开发（Spec-Driven）通用方案

## 目标
建立一套可落地的研发协作方案，使团队在“需求 → 规格 → 方案 → 执行 → 验收 → 沉淀”的全过程中：
- 减少歧义与返工
- 支持多种 AI / IDE / 研发工具并行使用
- 支持任务切换与断点续作
- 可通过预设包进行领域化增强
---

## 1. 命令/操作系统（CLI 或脚本化入口）

提供一组“标准化操作”来管理项目与任务生命周期（实现形式不限定，可用 CLI、Makefile、脚本、IDE Task 等）：

1. **项目初始化**
   - 生成：通用协作规范文档（如 `AGENTS.md`）
   - 生成：工作流命令/模板文件（供 AI 或团队成员复用）

2. **新建任务**
   - 创建任务目录
   - 生成需求简述模板（如 `brief.md`）

3. **切换任务**
   - 支持交互选择或指定任务名
   - 支持更新“当前任务指针”（用于断点续作）

4. **查看当前任务**
   - 输出当前激活任务信息

5. **同步命令/模板到工具侧**
   - 将项目内的标准命令/提示词/模板，分发到不同工具约定的目录结构中

6. **导入预设包**
   - 一键引入某个领域的规则与额外命令（如前端/后端/重构/文档）

7. **配置管理**
   - 交互式或文件式配置
   - 支持用户级/项目级覆盖

---

## 2. 多工具适配机制（AI/IDE/平台无关）

方案本身不绑定某个 AI 工具，通过“适配层”支持不同工具：

- **工具配置表**：为每个工具声明
  - 工具识别名
  - 规则/命令文件应放置的目录
  - 文件格式（如 Markdown / TOML / JSON 等）

- **格式转换能力**：
  - 在不同工具需要不同格式时，提供自动转换（例如 Markdown ↔ TOML）

- **同步策略**：
  - 保证“同一套命令与规范”可以投放到多个工具环境中，团队成员使用哪个工具都能获得一致体验

---

## 3. 标准工作流（需求到交付的流水线）

定义一套固定产出物（Outputs）的工作流，支持逐步推进、可回溯、可验收：

### 3.1 核心流程阶段与产物

1. **启动/建档**
   - 输入：初始需求
   - 产出：`brief.md`（需求简述、背景、目标、范围、非目标、约束）

2. **规格阶段（Spec）**
   - 目标：把模糊需求变成可讨论、可实现、可验收的规格
   - 产出：`1-spec.md`

3. **方案阶段（Plan）**
   - 基于规格给出技术方案、拆分任务、识别风险
   - 产出：`2-plan.md` + `3-tasks.md`

4. **执行阶段（Execute）**
   - 按任务清单逐项实施
   - 产出：任务清单状态更新、必要的实现记录

5. **验收阶段（Acceptance）**
   - 将规格转为可执行的验收用例/检查表
   - 产出：`acceptance.md`

6. **对齐阶段（Alignment，贯穿全程）**
   - 处理冲突、缺失、歧义、偏差，形成闭环
   - 产出：`alignment.md`

7. **总结沉淀（Summary）**
   - 提炼复用知识、决策记录、踩坑点
   - 产出：`summary.md`

> 可选：提供“一键跑完整流程”的聚合操作（自动生成/串联上述产物）。

---

## 4. 任务记忆与断点续作

通过一个“当前任务指针”实现状态持久化（不限定具体文件名与实现）：

- 新建任务后自动将其设置为当前任务
- 切换任务时更新当前任务指针
- 所有流程命令默认读取当前任务指针，无需用户重复指定
- 支持随时中断、下次继续

---

## 5. 配置系统（多级覆盖）

支持多级配置与默认值，建议优先级：

**项目级配置 > 用户级配置 > 默认配置**

可配置项示例：

- 规格/任务根目录名称（如 `specs/`）
- 命令前缀或命名空间（用于区分不同团队/项目的命令集）
- 默认启用的工具适配目标
- 模板语言/格式偏好

---

## 6. 预设包系统（可扩展的领域能力）

通过“预设包”快速注入某领域的附加规则与命令模板：

- **预设包内容**
  1. 追加到通用规范中的领域规则（如 API 设计规范、前端状态管理约定）
  2. 追加命令/提示词模板（如澄清、评审、重构检查）

- **内置预设示例**
  - 前端特化：交互/状态/组件规范、澄清模板
  - 后端开发：API/数据模型/服务架构模板
  - 重构优化：评审与风险控制清单
  - 文档写作：信息架构、受众分析、交付物模板

---

## 7. 对齐机制（Alignment）——冲突与歧义的强制闭环

规定统一的对齐记录方式，任何阶段发现问题必须写入对齐记录并跟踪关闭。

### 7.1 标准标签（示例）

- `[冲突]` 多来源信息矛盾
- `[缺失]` 关键信息不完整
- `[歧义]` 可多种解释
- `[偏差]` 实际实现与预期不一致
- `[待确认]` 需要相关方确认
- `[已确认]` 已得到结论

### 7.2 基本原则

- 对齐优先于继续实现（避免“带病推进”）
- 所有确认结论必须可追溯（记录时间、结论、相关人）

---

## 8. 标准目录结构（任务化、产物化）

建议统一的项目结构，保证可查找、可复用、可审计：

```
<specs_root>/
├── AGENTS.md                 # 通用规范/协作约定/工具使用规则
├── commands/                 # 通用命令/提示词/模板（可选）
└── <task_name>/              # 单个任务
    ├── brief.md              # 需求简述
    ├── assets/               # 相关素材：截图、链接、样例数据等
    ├── alignment.md          # 对齐记录
    └── outputs/              # 过程产物
        ├── 1-spec.md
        ├── 2-plan.md
        ├── 3-tasks.md
        ├── acceptance.md
        └── summary.md
```

---

## 9. 模板系统（变量替换与渲染）

模板支持变量占位符替换，用于生成项目标准文件与命令文本。

- 变量示例：
  - `{{specs_root}}` 规格根目录名
  - `{{cmd_prefix}}` 命令前缀/命名空间

可扩展：项目名、仓库名、负责人、日期等。

---

## 10. 交互式体验（可选）

为减少学习成本与操作失误，可提供交互式界面能力（不限技术实现）：

- 工具选择（多选、带默认）
- 任务选择（单选、分页）
- 配置级别选择（用户级/项目级）
- 文本输入（任务名、描述）

---
