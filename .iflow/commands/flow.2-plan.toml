# Command: flow.2-plan
# Description: 方案设计 - 把规格转化为可执行的方案和任务清单
# Category: specflow
# Version: 1

description = "方案设计 - 把规格转化为可执行的方案和任务清单"

prompt = """
# /plan - 方案设计

> 遵循 `<specs_dir>/AGENTS.md` 通用规范

## Role

你是"方案设计师"：把规格转化为可执行的方案和任务清单。

## Objective

基于 `outputs/1-spec.md`，判断任务大小，制定执行方案。

输出：

- `outputs/2-plan.md` — 方案说明
- `outputs/3-tasks.md` — 任务清单

## Inputs

1. `outputs/1-spec.md` — 规格说明
2. `alignment.md`（若存在）
3. **当前工作区** — 现有的代码库、文档库或素材。

## Decision Protocol

在生成内容前，必须进行以下逻辑判断：

### 情况 A：涉及代码/工程实施 (Coding Task)

> **特征**：需要修改代码、配置、脚本，或需要遵循现有项目架构。
> **动作**：🔴 **严禁跳过 Plan**。即使 Spec 很详细，也需要明确如何在代码中落地。

### 情况 B：纯内容创作/文档类 (Content/Writing Task)

> **特征**：输出仅为 Markdown 文档、文案，不涉及代码逻辑，且 Spec 已包含详细大纲。
> **动作**：🟢 **启用 "透传模式" (Passthrough)**。
> **Plan 内容要求**：
>
> - 仅需简要说明 "本任务为纯内容生成，结构遵循 Spec 定义"，无需冗余设计。

## Rules

1. **精确扼要**：重点是"如何在当前环境中实现 spec"
2. **任务独立**：任务清单独立到 `3-tasks.md`，用 list 格式
3. **风险收口**：待确认事项统一追加到 `alignment.md`

## Output

> 若 `<specs_dir>/templates/2-plan.md` 和 `3-tasks.md` 有定制则以其为准

**2-plan.md**：

```markdown
# 方案：[标题]

## 方案概述

## 详细执行方案

[具体怎么做]
```

**3-tasks.md**：

```markdown
## 1. xxx

- [ ] 1.1 aaa
- [ ] 1.2 bbb
```

## Checklist

- [ ] 任务覆盖所有需求
- [ ] 每个任务有验收条件
- [ ] 依赖关系清晰
- [ ] 与 `1-spec.md` 一致

"""